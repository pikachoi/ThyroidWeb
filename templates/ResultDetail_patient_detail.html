{% extends "Diagnosis_base.html" %}
{% block content %}
{% load static %}
{% load result_detial_filter %}
    <div id="content">
        <div class="container-fluid">
            <div class="card shadow mb-4" >
                <div class="card-body" >
                    <div class="row"  style = "background-color: #ededed;">
                        <div style="width: 100%; height: auto; ">
                            <br><br><br>
                            <h5 class="m-0 ml-3 text-gray-800">Patient id : {{ patient.patient_name }} &nbsp;&nbsp;&nbsp; Doctor ID : {{ patient.doctor }} &nbsp;&nbsp;&nbsp; Visit date : {{ patient.visit_date }}</h5>
                            <div>
                                <hr>
                                <h3 class="h3 mb-2 text-gray-600" align="left">■ Detected Nodules : {{crop_count.cnt}} &nbsp; ■ Present</h3>
                                {% if sagittal_img_path.idx == detect_img.idx %}
                                    <button class="btn btn-secondary" onclick="location.href='{% url 'patient_detail' patient.idx axial_img_path.idx 0 %}'">axial image 보기</button>
                                    <button class="btn btn-secondary">sagittal image</button>
                                {% elif sagittal_img_path %}
                                    <button class="btn btn-secondary">axial image</button>
                                    <button class="btn btn-secondary" onclick="location.href='{% url 'patient_detail' patient.idx sagittal_img_path.idx 0 %}'">sagittal image 보기</button>
                                {% endif %}
                            </div>
                            <hr>
                            {% if crop_img.is_nodule %}
                                <ul class="tabs">
                                    {% for crop_img_path_obj in crop_img_paths %}
                                        <li class="tab-link current" data-tab="nodule{{ forloop.counter }}" onclick="location.href='{% url 'patient_detail' patient.idx detect_img.idx crop_img_path_obj.idx %}'">tagging {{ forloop.counter }}</li>
                                    {% endfor %}
                                    
                                </ul>
                                <p class="h3 mb-2 text-gray-600" style = "display : inline;">■ Original Image </p>
                                <div class="row" style="margin-left: 2px;">
                                    <div class = "ori_img" > 
                                        <img class="card M-4" style="width: 70%; height:auto;"  src={{ detect_img.img_path.url|detect_nodule_img }}>
                                    </div>
                                    
                                    <div class="pb-2" style="float: center; width: 40%; height: auto;" align="center"> 
                                        <p class="h3 mb-2 text-gray-600" style = "float : left;">■ Crop Image </p>
                                            <img class="card M-4" style="width: auto; height:50%;" src={{ crop_img.crop_img_path.url }}> 
                                        
                                        {% with crop_img.classifi_result|get_classification as grade %}
                                            <h4 class="h3 mb-2 text-gray-600" style = "float:left; display : inline;">■ Guideline </h4>
                                            <table class="table_Guideline">    
                                                <thead class="thead-light">
                                                    <tr>
                                                        <th style='width: 20%;'>K-TIRADS</th>
                                                        <th style='width: 30%;'>Biopsy size threshold</th>
                                                    <th style='width: 40%;'>Malignancy Risk (%)</th>
                                                        </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td align = "center"> {{ grade }}</td>
                                                        {% if "C2" == grade %}
                                                            <td align="center">
                                                                <div class="tool">N/A <sup>(+)</sup></div>
                                                            </td>
                                                            <td align="center">
                                                                Spongiform :  &lt; 3<br>
                                                                else : &lt; 1
                                                            </td>
                                                        {% elif "C3" == grade %}
                                                            <td align="center">&gt; 2.0 cm</td>
                                                            <td align="center">3 ~ 10</td>
                                                        {% elif "C4" == grade %}
                                                            <td align="center">&gt; 1.0 ~ 1.5 cm</td>
                                                            <td align="center">15 ~ 40 </td>
                                                        {% elif "C5" == grade %}
                                                            <td align="center">
                                                                <div class="tool">
                                                                    &ge; 1.0 cm <sup>(+)</sup>
                                                                </div>
                                                            </td>
                                                            <td align="center">&gt; 60</td>
                                                        {% else %}
                                                            <td align="center">N/A</td>
                                                            <td align="center">N/A</td>
                                                        {% endif %}
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <table  class="table_Guideline">    
                                                <thead class="thead-light">
                                                    <tr>
                                                        <th style =" vertical-align: middle;">US Pattern</th>
                                                        {% if "C2" == grade %}
                                                            <td>
                                                                1) Spongiform<br>
                                                                2) Partially cystic nodule with comet tail artifact<br>
                                                                3) Pure cyst
                                                            </td>
                                                        {% elif "C3" == grade %}
                                                            <td>
                                                                Partially cystic or isohyperechoic nodule without any of 3 suspicious US features*
                                                            </td>
                                                        {% elif "C4" == grade %}
                                                            <td>
                                                                1) Solid hypoechoic nodule without any of 3 suspicious US features* <br>
                                                                2) Partially cystic or isohyperechoic nodule with any of 3 suspicious US features*
                                                            </td>
                                                        {% elif "C5" == grade %}
                                                            <td>
                                                                Solid hypoechoic nodule with any of 3 suspicious US features*
                                                            </td>
                                                        {% else %}
                                                            <td>N/A</td>
                                                            <td>N/A</td>
                                                        {% endif %}
                                                    </tr>
                                                    <tr>
                                                        <th style='width: 20%;'>Recommendation</th>
                                                        {% if "C2" == grade %}
                                                            <td align="center">
                                                                2-5 years depending on the nodule size
                                                            </td>
                                                        {% elif "C3" == grade %}
                                                            <td align="center">
                                                                At 1, 3, and 5 years -> every 5 years if there is no change 
                                                            </td>
                                                        {% elif "C4" == grade %}
                                                            <td align="center">
                                                                At 1, 3, and 5 years -> every 3-5 years if there is no change 
                                                            </td>
                                                        {% elif "C5" == grade %}
                                                            <td align="center">
                                                                US scan every 6 months for 1-2 years -> once every year, if no growth 
                                                            </td>
                                                        {% else %}
                                                            <td align="center">N/A</td>
                                                            <td align="center">N/A</td>
                                                        {% endif %}
                                                    </tr>
                                                </thead>
                                            </table>
                                        {% endwith %}
                                    </div>
                                    <div class="table-responsive" style = "margin-top : 10%;">
                                    <table class="table responsive-table">
                                        <thead class="thead-light">
                                            <tr>
                                                <th width="7.09%" scope="col" style = "text-align: center;">B / M</th>
                                                <th width="7.09%" scope="col" style = "text-align: center;">P / N</th>
                                                <th width="3.09%" scope="col" style = "text-align: center;">Echogenicity</th>
                                                <th width="11.09%" scope="col" style = "text-align: center;">Margin</th>
                                                <th width="15.09%" scope="col" style = "text-align: center;">Echogenic foci</th>
                                                <th width="10.50%" scope="col" style = "text-align: center;">Orientation</th>
                                                <th width="11.09%" scope="col" style = "text-align: center;">Shape</th>
                                                <th width="11.09%" scope="col" style = "text-align: center;">Composition</th>
                                               
                                                
                                                <th width="4.09%" scope="col"></th>                                                                      
                                                <th width="9.09%" scope="col" style= "background-color : #fae0e0; text-align: center;">※ K-TIRADS</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <div style="text-align: center;font-size: 13px; ">
                                                        {% for spec, value in crop_img.classifi_result|get_spec:"BM" %}
                                                            <p style = "color:#000; font-weight: bold;" class="{{spec}}"> {{spec}} : {{value}} % </p>
                                                        {% endfor %}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div style="text-align: center;font-size: 13px;">
                                                        {% for spec, value in crop_img.classifi_result|get_spec:"PN" %}
                                                            <p style = "color:#000; font-weight: bold;" class="{{spec}}"> {{spec}} : {{value}} % </p>
                                                        {% endfor %}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div style="text-align: center;font-size: 13px;">
                                                        {% for spec, value in crop_img.classifi_result|get_spec:"ECHO" %}
                                                        <p style = "color:#000; font-weight: bold;" class="{{spec}}"> {{spec}} : {{value}} % </p>
                                                        {% endfor %}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div style="text-align: center;font-size: 13px;">
                                                        {% for spec, value in crop_img.classifi_result|get_spec:"MARGIN" %}
                                                            <p style = "color:#000; font-weight: bold;" class="{{spec}}"> {{spec}} : {{value}} % </p>
                                                        {% endfor %}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div style="text-align: center;font-size: 13px;">
                                                        {% for spec, value in crop_img.classifi_result|get_spec:"ECHOGENIC_FOCI" %}
                                                            <p style = "color:#000; font-weight: bold;" class="{{spec}}"> {{spec}} : {{value}} % </p>
                                                        {% endfor %}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div style="text-align: center;font-size: 13px;">
                                                        {% for spec, value in crop_img.classifi_result|get_spec:"ORIENTATION" %}
                                                            <p style = "color:#000; font-weight: bold;" class="{{spec}}"> {{spec}} : {{value}} % </p>
                                                        {% endfor %}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div style="text-align: center;font-size: 13px;">
                                                        {% for spec, value in crop_img.classifi_result|get_spec:"SHAPE" %}
                                                            <p style = "color:#000; font-weight: bold;" class="{{spec}}"> {{spec}} : {{value}} % </p>
                                                        {% endfor %}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div style="text-align: center;font-size: 13px;">
                                                        {% for spec, value in crop_img.classifi_result|get_spec:"COMPOSITION" %}
                                                            <p style = "color:#000; font-weight: bold;" class="{{spec}}"> {{spec}} : {{value}} % </p>
                                                        {% endfor %}
                                                    </div>
                                                </td>
                                               
                                                
                                                <td></td>
                                                <td style = "background-color : #fae0e0;">
                                                    <div style="text-align: center;font-size: 13px;">
                                                        {% for spec, value in crop_img.classifi_result|get_spec:"GRADE" %}
                                                            <p style = "color:#000; font-weight: bold;" class="{{spec}}"> {{spec}} : {{value}} % </p>
                                                        {% endfor %}
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    </div>
                                </div>
                            {% else %}
                                <div class="row" style="margin-left: 2px;">
                                    <ul class="tabs">
                                        <li class="tab-link current" data-tab="image">Original Image</li>
                                        <h3 class="h3 mb-2 text-gray-600" align="center">■ Detected Nodules : 0 ■ Absent</h3>
                                    </ul>
                                </div>
                                <div class="pb-2" style="float: left; width: 50%; height: auto;" align="center"> 
                                    <img class="card M-4" style="width: 70%; height:auto;" src={{ detect_img.img_path.url }}>
                                </div>
                                <div class="row" >
                                    <div>
                                        <h5 class="h5 mb-2 text-gray-600" style="margin-top: 20%;">● Nodules did not detected.</h5>
                                        <h5 class="h5 mb-2 text-gray-600" style="margin-top: 20%;">● Please check the image.</h5>
                                    </div>
                                </div>
                            {% endif %}
                            <div style="margin-top: 10px;">
                                <table style="font-size: 13px; table-layout: fixed;" class="table table-striped table-bordered sortable-table clickable-table" id="problemset">
                                    <thead>
                                        <tr>
                                            <th style="text-align:center;width:10%">nodule</th>
                                            <th style="text-align:center;width:60%">Tagging</th>
                                            <th colspan="2" style="text-align:center;width:30%">동의여부 </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="vertical-align:middle;width:70%">nodule</td>
                                            <td style="vertical-align:middle;width:70%">
                                                <div class="progress progress-striped active" style="margin-bottom: 0px;">
                                                    {% for total_agree_obj in total_agree %}
                                                        {% if total_agree_obj.crop_img_path == crop_img.idx %} 
                                                            <div class="progress-bar pb" style="width: 20%;">
                                                                <span style="vertical-align:middle">{{ total_agree_obj.cnt }}</span>
                                                            </div>                                                                
                                                        {% endif %}
                                                    {% endfor %}
                                                    {% for total_disagree_obj in total_disagree %}
                                                        {% if total_disagree_obj.crop_img_path == crop_img.idx %} 
                                                            <div class="progress-bar bg-danger pb1" style="width: 20%;">
                                                                <span style="vertical-align:middle">{{ total_disagree_obj.cnt }}</span>
                                                            </div>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </td>
                                            <td style="vertical-align:middle; text-align: center;">
                                                <button type="button" align='center' name="tagging" id="agree_btn" class="like1 btn btn-success glyphicon glyphicon-thumbs-up" {% if disable_buttons %}disabled{% endif %}>Agree</button>
                                            </td>
                                            <td style="vertical-align:middle; text-align: center;">
                                                <button type="button" align='center' name="tagging1" id="disagree_btn" class="dislike btn btn-danger glyphicon glyphicon-thumbs-down" {% if disable_buttons %}disabled{% endif %}>Disagree</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot >
                                        <tr>
                                            <td colspan="4" style="background-color:white;"> 
                                                <form id="agree_form" action ="{% url 'agree_tagging' crop_img.idx %}" method="POST" style="display:none;" >
                                                    {% csrf_token %}
                                                    <textarea name="body" cols="40" rows="10" maxlength="200"  class="text_modal2_body" id="id_body" placeholder="Comment..." required ></textarea>
                                                    <input type="submit" class="comment_save" value="Save" />
                                                    <input type="reset" class="comment_delete" value="Delete" data-dismiss="modal" />
                                                </form>
                                            </td>
                                            <td colspan="4" style="background-color:white;"> 
                                                <form id="disagree_form" action ="{% url 'disagree_tagging' crop_img.idx %}" method="POST" style="display:none;">
                                                    {% csrf_token %}
                                                    <textarea name="body"  cols="40" rows="10" maxlength="200"  class="text_modal2_body" id="id_body" placeholder="Comment..." required ></textarea>
                                                    <input type="submit" class="comment_save" value="Save" />
                                                    <input type="reset" class="comment_delete" value="Delete" data-dismiss="modal" />
                                                </form>
                                            </td>
                                        <tr>
                                    </tfoot>
                                </table>
                            </div>
                            <div class = "flex-container">    
                                <div class = "comment_table">   
                                    <table style="font-size: 13px" class="table table-striped table-bordered sortable-table clickable-table" id="problemset">
                                    {% csrf_token %}
                                    <thead>
                                        <td class="th_comment" id="th_comment" colspan="4">C O M M E N T</td>
                                        <tr>
                                            <th style="text-align:center; width:20%;" data-sort="string">Doctor ID</th>
                                            <th style="text-align:center; width:20%;">Date</th>
                                            <th style="text-align:center; width:50%;">Comment</th>
                                            <th style="text-align:center; width:50%;">Delete</th>
                                        </tr>
                                    </thead>
                                    <tbody class="tbody-comment">
                                        {% for total_tagging_obj in total_tagging %}
                                            <tr>
                                                <td style="vertical-align:middle" class="click-this">{{ total_tagging_obj.doctor }}</td>
                                                <td style="vertical-align:middle" class="click-this">{{ total_tagging_obj.write_date }}</td>
                                                <td style="text-align:left;" class="click-this">{{ total_tagging_obj.comment }}</td>
                                                
                                                {% if doctor_username == total_tagging_obj.doctor %}
                                                    <td align="center" width="50">
                                                        <form action="{% url 'remove_tagging' total_tagging_obj.idx %}" method="POST">
                                                            {% csrf_token %}
                                                            <button type="button" class="btn btn-outline-secondary" onclick="confirm_delete_comment(this)">Delete</button>
                                                        </form>
                                                    </td> 
                                                {% else %}
                                                    <td align="center" style="vertical-align: middle;">
                                                        <button type="button" class="btn btn-outline-info" onclick="dontDelete()">Delete</button>
                                                    </td>
                                                {% endif %}
                                            </tr>
                                        {% empty %}
                                            <tr>
                                                <td colspan="4" align="center" style="vertical-align: middle;">아직 코멘트가 없습니다.</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                                </div>
                                <div class="interpretation_table">
                                    <table style="font-size: 13px" class="table table-striped table-bordered sortable-table clickable-table" id="problemset">
                                        {% csrf_token %}
                                        <thead>
                                            <td class="th_interpretation" id="th_interpretation" colspan="4">
                                                I N T E R P R E T A T I O N
                                                {% if doctor_username == patient.doctor and not interpretation %}
                                                    <button class="interpretation_write_button">판독문 작성</button>
                                                {% endif %}
                                            </td>
                                            <tr>
                                                <th style="text-align:center; width:20%;" data-sort="string">Doctor ID</th>
                                                <th style="text-align:center; width:20%">Date</th>
                                                <th align="text-align:center; width:400px;" style="text-align:center; width:50%; ">Interpretation</th>
                                                <th style="text-align:center; width:50%;">Delete</th>
                                            </tr>
                                        </thead>
                                        <tbody class="tbody-interpretation">
                                            {% for interpret in interpretation %}
                                                <tr>
                                                    {% if doctor_username == interpret.patient.doctor %}
                                                        <td style="vertical-align:middle" class="click-this">{{ interpret.patient.doctor }}</td>
                                                        <td style="vertical-align:middle" class="click-this">{{ interpret.write_date }}</td>
                                                        <td style="text-align: left; white-space: pre-line;">{{ interpret.interpretation }}</td>
                                                        <td align="center" width="50">
                                                            <form action="{% url 'remove_interpretation' interpret.idx %}" method="POST">
                                                                {% csrf_token %}
                                                                <button type="button" class="btn btn-outline-secondary" onclick="confirm_delete_interpretation(this)">Delete</button>
                                                            </form>
                                                        </td>
                                                    {% else %}
                                                        <td colspan="4" align="center" style="vertical-align: middle;">판독문은 진료의만 볼 수 있습니다.</td>
                                                    {% endif %}
                                                </tr>
                                            {% empty %}
                                                <tr>
                                                    <td colspan="4" align="center" style="vertical-align: middle;">아직 판독문이 없습니다.</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="id_interpretation">
                                <form id="write_interpretation" action="{% url 'write_interpretation' patient.idx %}" method="POST">
                                    {% csrf_token %}
                                    <div class="interpretation_body">
                                        <div class="check_list">

                                            <!-- 결절 위치 (오른, 왼, 지협) -->
                                            <div class="checklist_one_line">
                                                <div class="checklist_column">Location</div>
                                                <div class="checklist_items">
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item1-1" name="item1" value="Item1-1">
                                                    <label style="margin: 0px;" for="item1-1">Rt</label>
                                    
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item1-2" name="item1" value="Item1-2">
                                                    <label style="margin: 0px;" for="item1-2">Lt</label>
                                    
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item1-3" name="item1" value="Item1-3">
                                                    <label style="margin: 0px;" for="item1-3">ISt</label>
                                                </div>
                                            </div>

                                            <!-- 결절 위치 (높은, 중간, 낮은) -->
                                            <div class="checklist_one_line">
                                                <div class="checklist_column">Location</div>
                                                <div class="checklist_items">
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item2-1" name="item2" value="Item2-1">
                                                    <label style="margin: 0px;" for="item2-1">upper</label>
                                    
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item2-2" name="item2" value="Item2-2">
                                                    <label style="margin: 0px;" for="item2-2">mid</label>
                                    
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item2-3" name="item2" value="Item2-3">
                                                    <label style="margin: 0px;" for="item2-3">lower</label>
                                                </div>
                                            </div>

                                          
                                            <div class="checklist_one_line">
                                                <div class="checklist_column" style="height: 80px;">Diameter</div>
                                                <div style="width: 100%; height: 80px; border-bottom: solid 1px; text-align: left; padding: 5px;">
                                                    <div style=" height: 25px; display: flex; justify-content: left; align-items: center;">
                                                        <input style="width: 50px; height: 100%; border: solid 1px;" type="number" id="width" placeholder="w" oninput="calculateVolume(this)">
                                                        &nbsp;X&nbsp;
                                                        <input style="width: 50px; height: 100%; border: solid 1px;" type="number" id="height" placeholder="l" oninput="calculateVolume(this)">
                                                        &nbsp;X&nbsp;
                                                        <input style="width: 50px; height: 100%; border: solid 1px;" type="number" id="depth" placeholder="h" oninput="calculateVolume(this)">
                                                        &nbsp;&nbsp;&nbsp;
                                                        <select style="width: 50px; height: 100%; border: solid 1px; background-color: rgb(221, 221, 221);" id="unitSelector" onchange="convertUnits()">
                                                            <option value="mm" selected>mm</option>
                                                            <option value="cm">cm</option>
                                                        </select>
                                                    </div>
                                                    <div style="margin-top: 5px;">Volume=&nbsp;&nbsp; <small style="font-size: 14px; color: brown;" id="volume-result"></small><small style="font-size: 14px;"> &nbsp; mL</small></div>
                                                    <div style="margin-top: 0px;">Maximal size=&nbsp;&nbsp; <small style="font-size: 14px; color: brown" id="largestNumber"></small> <small style="font-size: 14px;" id="currentUnit"> &nbsp;</small></div>
                                                </div>
                                            </div>

                                            <!-- 종양의 양성과 악성을 평가 -->
                                            <div class="checklist_one_line">
                                                <div class="checklist_column">B/M</div>
                                                <div class="checklist_items">
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item0-1" name="item0" value="Item0-1">
                                                    <label style="margin: 0px;" for="item0-1">Benign</label>
                                    
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item0-2" name="item0" value="Item0-2">
                                                    <label style="margin: 0px;" for="item0-2">Malignant</label>
                                                </div>
                                            </div>

                                            <!-- 종양의 변이 여부를 평가 -->
                                            <div class="checklist_one_line">
                                                <div class="checklist_column">P/N</div>
                                                <div class="checklist_items">
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item00-1" name="item00" value="Item00-1">
                                                    <label style="margin: 0px;" for="item00-1">Positive</label>
                                    
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item00-2" name="item00" value="Item00-2">
                                                    <label style="margin: 0px;" for="item00-2">Negative</label>
                                                </div>
                                            </div>

                                            <!-- 특성 Echogenicity -->
                                            <div class="checklist_one_line">
                                                <div class="checklist_column">Echogenicity</div>
                                                <div class="checklist_items">
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item3-1" name="item3" value="Item3-1">
                                                    <label style="margin: 0px;" for="item3-1">Hypoechogenicity</label>
                                    
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item3-2" name="item3" value="Item3-2">
                                                    <label style="margin: 0px;" for="item3-2">Isoechogenicity</label>
                                                </div>
                                            </div>

                                            <!-- 특성 Margin -->
                                            <div class="checklist_one_line">
                                                <div class="checklist_column">Margin</div>
                                                <div class="checklist_items">
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item4-1" name="item4" value="Item4-1">
                                                    <label style="margin: 0px;" for="item4-1">Smooth</label>
                                    
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item4-2" name="item4" value="Item4-2">
                                                    <label style="margin: 0px;" for="item4-2">Ill-defined</label>

                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item4-3" name="item4" value="Item4-3">
                                                    <label style="margin: 0px;" for="item4-3">Spiculated</label>
                                                </div>
                                            </div>

                                            <!-- 특성 Echogenicity foci -->
                                            <div class="checklist_one_line">
                                                <div class="checklist_column" style="height: 45px;">Echogenicity foci</div>
                                                <div class="checklist_items" style="height: 45px;">
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item5-1" name="item5" value="Item5-1">
                                                    <label style="margin: 0px;" for="item5-1">Absent</label>
                                    
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item5-2" name="item5" value="Item5-2">
                                                    <label style="margin: 0px;" for="item5-2">Punctate echogenic foci</label>
                                        
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item5-3" name="item5" value="Item5-3">
                                                    <label style="margin: 0px;" for="item5-3">Macro</label>
                                                </div>
                                            </div>

                                            <!-- 특성 Orientation -->
                                            <div class="checklist_one_line">
                                                <div class="checklist_column">Orientation</div>
                                                <div class="checklist_items">
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item6-1" name="item6" value="Item6-1">
                                                    <label style="margin: 0px;" for="item6-1">Parallel</label>
                                    
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item6-2" name="item6" value="Item6-2">
                                                    <label style="margin: 0px;" for="item6-2">Nonparallel</label>
                                                </div>
                                            </div>

                                            <!-- 특성 Shape -->
                                            <div class="checklist_one_line">
                                                <div class="checklist_column">Shape</div>
                                                <div class="checklist_items">
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item7-1" name="item7" value="Item7-1">
                                                    <label style="margin: 0px;" for="item7-1">Round_to_oval</label>
                                    
                                                    <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item7-2" name="item7" value="Item7-2">
                                                    <label style="margin: 0px;" for="item7-2">Irregular</label>
                                                </div>
                                            </div>

                                            <!-- 특성 Internal -->
                                            <div class="checklist_one_line">
                                                <div class="checklist_column" style="height: 50px;">Internal</div>
                                                <div style="width: 100%;">
                                                    
                                                    <div class="checklist_items" style="height: 25px; border: 0px;">
                                                        <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item8-1" name="item8" value="Item8-1">
                                                        <label style="margin: 0px;" for="item8-1">Solid</label>
                                        
                                                        <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item8-2" name="item8" value="Item8-2">
                                                        <label style="margin: 0px;" for="item8-2">Predominantly_Solid</label>

                                                        
                                                    </div>
                                                    <div class="checklist_items" style="height: 25px;">
                                                        <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item8-3" name="item8" value="Item8-3">
                                                        <label style="margin: 0px;" for="item8-3">Benign_Cystic</label>

                                                        <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item8-4" name="item8" value="Item8-4">
                                                        <label style="margin: 0px;" for="item8-4">Colloid</label>

                                                        <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item8-5" name="item8" value="Item8-5">
                                                        <label style="margin: 0px;" for="item8-5">Spongiform</label>
                                                    </div>

                                                </div>
                                            </div>

                                            <!-- K-TIRADS 기준 악성종양 위험도 -->
                                            <div class="checklist_one_line">
                                                <div class="checklist_column" style="height: 50px;">K-TIRADS</div>
                                                <div style="width: 100%;">
                                                    
                                                    <div class="checklist_items" style="height: 25px; border: 0px;">
                                                        <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item9-1" name="item9" value="Item9-1">
                                                        <label style="margin: 0px;" for="item9-1">K-TIRADS 1</label>
                                        
                                                        <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item9-2" name="item9" value="Item9-2">
                                                        <label style="margin: 0px;" for="item9-2">K-TIRADS 2</label>

                                                        <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item9-3" name="item9" value="Item9-3">
                                                        <label style="margin: 0px;" for="item9-3">K-TIRADS 3</label>
                                                    </div>
                                                    <div class="checklist_items" style="height: 25px;">
                                                        <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item9-4" name="item9" value="Item9-4">
                                                        <label style="margin: 0px;" for="item9-4">K-TIRADS 4</label>

                                                        <input style="margin-left: 10px; margin-right: 5px;" type="checkbox" id="item9-5" name="item9" value="Item9-5">
                                                        <label style="margin: 0px;" for="item9-5">K-TIRADS 5</label>
                                                    </div>

                                                </div>
                                            </div>

                                        </div>
                                        <!-- 복사된 판독문 -->
                                        <textarea
                                            name="interpretation"
                                            cols="40"
                                            rows="5"
                                            maxlength="700"
                                            data-backdrop="static"
                                            data-keyboard="false"
                                            class="copied_interpretation"
                                            id="selected_items"
                                            placeholder="interpretation"
                                            required>
                                        </textarea>
                                    </div>

                                    <div class="interpretation_button_elements">
                                        <input type="submit" value="Save" />
                                        <button type="button" class="interpretation_reset">Reset</button> <!-- 초기화 버튼 추가 -->
                                        <span  class="interpretation_close_button" >&times;</span>
                                    </div>

                                    <!-- 원본 판독문 -->                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                    <div style="white-space: pre-line;" class="original_interpretation">
                                        A nodule measuring [<span id="width-text"></span><span id="currentUnit1"></span> x <span id="height-text"></span><span id="currentUnit2"></span> x <span id="depth-text"></span><span id="currentUnit3"></span>] and having a volume of [<span id="volume-result2"></span>ml] was discovered in the <span id="item2-text"></span> portion of the <span id="item1-text"></span> thyroid gland.

                                        This nodule is <span id="item00-text"></span>, and the identified characteristics are as follows:

                                        Echogenicity: <span id="item3-text"></span>
                                        Margin: <span id="item4-text"></span>
                                        Echogenicity Foci: <span id="item5-text"></span>
                                        Orientation: <span id="item6-text"></span>
                                        Shape: <span id="item7-text"></span>
                                        Internal Composition: <span id="item8-text"></span>

                                        Based on these characteristics, it has been classified as <span id="item9-text"></span>.
                                

                                        <span style="display: none;" id="item0-text"></span>, 

                                 
                                    </div>

                                    {% for spec, value in crop_img.classifi_result|get_spec:"BM" %}
                                    <div class="BM-result" BM-spec="{{ spec }}" BM-value="{{ value }}"></div>
                                    {% endfor %}

                                    {% for spec, value in crop_img.classifi_result|get_spec:"PN" %}
                                    <div class="PN-result" PN-spec="{{ spec }}" PN-value="{{ value }}"></div>
                                    {% endfor %}

                                    {% for spec, value in crop_img.classifi_result|get_spec:"ECHO" %}
                                        <div class="ECHO-result" ECHO-spec="{{ spec }}" ECHO-value="{{ value }}"></div>
                                    {% endfor %}

                                    {% for spec, value in crop_img.classifi_result|get_spec:"MARGIN" %}
                                    <div class="MARGIN-result" MARGIN-spec="{{ spec }}" MARGIN-value="{{ value }}"></div>
                                    {% endfor %}

                                    {% for spec, value in crop_img.classifi_result|get_spec:"ECHOGENIC_FOCI" %}
                                    <div class="ECHOGENIC_FOCI-result" ECHOGENIC_FOCI-spec="{{ spec }}" ECHOGENIC_FOCI-value="{{ value }}"></div>
                                    {% endfor %}

                                    {% for spec, value in crop_img.classifi_result|get_spec:"ORIENTATION" %}
                                    <div class="ORIENTATION-result" ORIENTATION-spec="{{ spec }}" ORIENTATION-value="{{ value }}"></div>
                                    {% endfor %}

                                    {% for spec, value in crop_img.classifi_result|get_spec:"SHAPE" %}
                                    <div class="SHAPE-result" SHAPE-spec="{{ spec }}" SHAPE-value="{{ value }}"></div>
                                    {% endfor %}

                                    {% for spec, value in crop_img.classifi_result|get_spec:"COMPOSITION" %}
                                    <div class="COMPOSITION-result" COMPOSITION-spec="{{ spec }}" COMPOSITION-value="{{ value }}"></div>
                                    {% endfor %}

                                    {% for spec, value in crop_img.classifi_result|get_spec:"GRADE" %}
                                    <div class="GRADE-result" GRADE-spec="{{ spec }}" GRADE-value="{{ value }}"></div>
                                    {% endfor %}

                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- "This nodule is positive, and the identified characteristics are as follows:

    Echogenicity: 'Hypoechogenicity'
    Margin: 'Smooth'
    Echogenicity Foci: 'Absent'
    Orientation: 'Parallel'
    Shape: 'Round to oval'
    Internal Composition: 'Solid'
    Based on these characteristics, it has been classified as K-TIRADS 2." 

    이 결절은 양성이며, 확인된 특징은 다음과 같습니다:

초음파 밝기: '저밝기'
경계: '부드러운'
초음파 밝기 중심: '없음'
방향: '평행'
모양: '둥근 형태에서 타원 형태로'
내부 구성: '고체'
이러한 특징들을 기반으로 K-TIRADS 2로 분류되었습니다." -->

    <script>
        var unitSelector = document.getElementById("unitSelector");

        function calculateVolume(input) {
            // 입력 필드에서 숫자 3자리로 제한
            var inputValue = input.value;
            if (inputValue.length > 3) {
                input.value = inputValue.slice(0, 3);
            }

            // 사용자로부터 입력된 가로, 세로, 높이 가져오기
            var width = parseFloat(document.getElementById("width").value);
            var height = parseFloat(document.getElementById("height").value);
            var depth = parseFloat(document.getElementById("depth").value);

            // 입력된 숫자가 없으면 메시지 표시
            if (isNaN(width) || isNaN(height) || isNaN(depth)) {
                document.getElementById("volume-result").textContent = " ";
                document.getElementById("largestNumber").textContent = " ";
                return;
            }

            // 구의 부피 계산
            var Wradius = width / 2;
            var Hradius = height / 2;
            var Dradius = depth / 2;
            var volume = (4/3) * Math.PI * Wradius * Hradius * Dradius

            // 선택된 단위에 따라 부피를 변환
            var currentUnit = unitSelector.value;
            if (currentUnit === "mm") {
                volume *= 0.001; // cm^3에서 mm^3로 변환
            }

            // 결과를 화면에 표시
            var roundedVolume = volume.toFixed(2); // 소수점 둘째 자리까지 반올림
            document.getElementById("volume-result").textContent = roundedVolume;
            document.getElementById("volume-result2").textContent = roundedVolume;
            document.getElementById("currentUnit").textContent = currentUnit;
            document.getElementById("currentUnit1").textContent = currentUnit;
            document.getElementById("currentUnit2").textContent = currentUnit;
            document.getElementById("currentUnit3").textContent = currentUnit;

            document.getElementById("width-text").textContent = width;
            document.getElementById("height-text").textContent = height;
            document.getElementById("depth-text").textContent = depth;

            var largestNumber = Math.max(width, height, depth);
            document.getElementById("largestNumber").textContent = largestNumber;

            // container_B에 복사
            const containerAText = document.querySelector('.original_interpretation').innerText;
            textarea.value = containerAText; // textarea에 original_interpretation 내용 복사
        }

        function convertUnits() {
            calculateVolume(document.getElementById("width"));
        }

        // 초기 계산 수행
        calculateVolume(document.getElementById("width"));
    </script>


    <script>
        //-------------------------------------------------------------BM

        const BM_elements = document.querySelectorAll('.BM-result');
        const BM_Text = document.getElementById('item0-text');

        let BM_1_Value = null;
        let BM_2_Value = null;

        BM_elements.forEach(element => {
            const BM_specData = element.getAttribute('BM-spec');
            const BM_valueData = parseFloat(element.getAttribute('BM-value'));

            if (BM_1_Value === null) {
                BM_1_Value = BM_valueData;
            } else if (BM_2_Value === null) {
                BM_2_Value = BM_valueData;
            }
        
            console.log(`${BM_specData}${BM_valueData}`);
        });

        let BM_resultSpecData = null;
        if (BM_1_Value !== null && BM_2_Value !== null) {
            if (BM_1_Value > BM_2_Value) {
                BM_resultSpecData = BM_elements[0].getAttribute('BM-spec');
            } else {
                BM_resultSpecData = BM_elements[1].getAttribute('BM-spec');
            }
        }

        if (BM_resultSpecData === 'B') {
            const Benign = document.getElementById("item0-1");
            Benign.checked = true; 
            BM_Text.textContent = `Benign`;
        }
        else {
            const Malignant = document.getElementById("item0-2");
            Malignant.checked = true; 
            BM_Text.textContent = `Malignant`;
        }

        //-------------------------------------------------------------PN

        const PN_elements = document.querySelectorAll('.PN-result');
        const PN_Text = document.getElementById('item00-text');
        
        let PN_1_Value = null;
        let PN_2_Value = null;

        PN_elements.forEach(element => {
            const PN_specData = element.getAttribute('PN-spec');
            const PN_valueData = parseFloat(element.getAttribute('PN-value'));

            if (PN_1_Value === null) {
                PN_1_Value = PN_valueData;
            } else if (PN_2_Value === null) {
                PN_2_Value = PN_valueData;
            }
        
            console.log(`${PN_specData}${PN_valueData}`);
        });

        let PN_resultSpecData = null;
        if (PN_1_Value !== null && PN_2_Value !== null) {
            if (PN_1_Value > PN_2_Value) {
                PN_resultSpecData = PN_elements[0].getAttribute('PN-spec');
            } else {
                PN_resultSpecData = PN_elements[1].getAttribute('PN-spec');
            }
        }

        if (PN_resultSpecData === 'P') {
            const Positive = document.getElementById("item00-1");
            Positive.checked = true; 
            PN_Text.textContent = `positive`;
        }
        else {
            const Negtive = document.getElementById("item00-2");
            Negtive.checked = true; 
            PN_Text.textContent = `negtive`;
        }

        //-------------------------------------------------------------ECHO

        const ECHO_elements = document.querySelectorAll('.ECHO-result');
        const ECHO_Text = document.getElementById('item3-text');
     
        let ECHO_1_Value = null;
        let ECHO_2_Value = null;

        ECHO_elements.forEach(element => {
            const ECHO_specData = element.getAttribute('ECHO-spec');
            const ECHO_valueData = parseFloat(element.getAttribute('ECHO-value'));

            if (ECHO_1_Value === null) {
                ECHO_1_Value = ECHO_valueData;
            } else if (ECHO_2_Value === null) {
                ECHO_2_Value = ECHO_valueData;
            }
        
            console.log(`${ECHO_specData}${ECHO_valueData}`);
        });

        let ECHO_resultSpecData = null;
        if (ECHO_1_Value !== null && ECHO_2_Value !== null) {
            if (ECHO_1_Value > ECHO_2_Value) {
                ECHO_resultSpecData = ECHO_elements[0].getAttribute('ECHO-spec');
            } else {
                ECHO_resultSpecData = ECHO_elements[1].getAttribute('ECHO-spec');
            }
        }

        if (ECHO_resultSpecData === 'Hypoechogenicity') {
            const hypoechogenicityCheckbox = document.getElementById("item3-1");
            hypoechogenicityCheckbox.checked = true; 
            ECHO_Text.textContent = `Hypoechogenicity`;
        }
        else {
            const Isoechogenicity = document.getElementById("item3-2");
            Isoechogenicity.checked = true;
            ECHO_Text.textContent = `Isoechogenicity`;
        }

        //-------------------------------------------------------------MARGIN

        const MARGIN_elements = document.querySelectorAll('.MARGIN-result');
        const MARGIN_Text = document.getElementById('item4-text');
     
        let MARGIN_1_Value = null;
        let MARGIN_2_Value = null;
        let MARGIN_3_Value = null;

        MARGIN_elements.forEach(element => {
            const MARGIN_specData = element.getAttribute('MARGIN-spec');
            const MARGIN_valueData = parseFloat(element.getAttribute('MARGIN-value'));

            if (MARGIN_1_Value === null) {
                MARGIN_1_Value = MARGIN_valueData;
            } else if (MARGIN_2_Value === null) {
                MARGIN_2_Value = MARGIN_valueData;
            } else if (MARGIN_3_Value === null) {
                MARGIN_3_Value = MARGIN_valueData;
            }
        
            console.log(`${MARGIN_specData}${MARGIN_valueData}`);
        });

        let MARGIN_resultSpecData = null;
        if (MARGIN_1_Value !== null && MARGIN_2_Value !== null && MARGIN_3_Value !== null) {

            var maxMarginValue = Math.max(MARGIN_1_Value, MARGIN_2_Value, MARGIN_3_Value);

            if (maxMarginValue === MARGIN_1_Value) {
                MARGIN_resultSpecData = MARGIN_elements[0].getAttribute('MARGIN-spec');
            } else if (maxMarginValue === MARGIN_2_Value) {
                MARGIN_resultSpecData = MARGIN_elements[1].getAttribute('MARGIN-spec');
            } else {
                MARGIN_resultSpecData = MARGIN_elements[2].getAttribute('MARGIN-spec');
            }
        }

        if (MARGIN_resultSpecData === 'Smooth') {
            const Smooth = document.getElementById("item4-1");
            Smooth.checked = true; 
            MARGIN_Text.textContent = `Smooth`;
        }
        else if (MARGIN_resultSpecData === 'Ill-defined') {
            const Ill_defined = document.getElementById("item4-2");
            Ill_defined.checked = true;
            MARGIN_Text.textContent = `Ill-defined`;
        }
        else {
            const Spiculated = document.getElementById("item4-3");
            Spiculated.checked = true;
            MARGIN_Text.textContent = `Spiculated`;
        }
        
        //-------------------------------------------------------------ECHOGENIC_FOCI

        const ECHOGENIC_FOCI_elements = document.querySelectorAll('.ECHOGENIC_FOCI-result');
        const ECHOGENIC_FOCI_Text = document.getElementById('item5-text');
     
        let ECHOGENIC_FOCI_1_Value = null;
        let ECHOGENIC_FOCI_2_Value = null;
        let ECHOGENIC_FOCI_3_Value = null;

        ECHOGENIC_FOCI_elements.forEach(element => {
            const ECHOGENIC_FOCI_specData = element.getAttribute('ECHOGENIC_FOCI-spec');
            const ECHOGENIC_FOCI_valueData = parseFloat(element.getAttribute('ECHOGENIC_FOCI-value'));

            if (ECHOGENIC_FOCI_1_Value === null) {
                ECHOGENIC_FOCI_1_Value = ECHOGENIC_FOCI_valueData;
            } else if (ECHOGENIC_FOCI_2_Value === null) {
                ECHOGENIC_FOCI_2_Value = ECHOGENIC_FOCI_valueData;
            } else if (ECHOGENIC_FOCI_3_Value === null) {
                ECHOGENIC_FOCI_3_Value = ECHOGENIC_FOCI_valueData;
            }
        
            console.log(`${ECHOGENIC_FOCI_specData}${ECHOGENIC_FOCI_valueData}`);
        });

        let ECHOGENIC_FOCI_resultSpecData = null;
        if (ECHOGENIC_FOCI_1_Value !== null && ECHOGENIC_FOCI_2_Value !== null && ECHOGENIC_FOCI_3_Value !== null) {
            
            var maxECHOGENIC_FOCIValue = Math.max(ECHOGENIC_FOCI_1_Value, ECHOGENIC_FOCI_2_Value, ECHOGENIC_FOCI_3_Value);

            if (maxECHOGENIC_FOCIValue === ECHOGENIC_FOCI_1_Value) {
                ECHOGENIC_FOCI_resultSpecData = ECHOGENIC_FOCI_elements[0].getAttribute('ECHOGENIC_FOCI-spec');
            } else if (maxECHOGENIC_FOCIValue === ECHOGENIC_FOCI_2_Value) {
                ECHOGENIC_FOCI_resultSpecData = ECHOGENIC_FOCI_elements[1].getAttribute('ECHOGENIC_FOCI-spec');
            } else {
                ECHOGENIC_FOCI_resultSpecData = ECHOGENIC_FOCI_elements[2].getAttribute('ECHOGENIC_FOCI-spec');
            }
        }

        if (ECHOGENIC_FOCI_resultSpecData === 'Absent') {
            const Absent = document.getElementById("item5-1");
            Absent.checked = true; 
            ECHOGENIC_FOCI_Text.textContent = `Absent`;
        }
        else if (ECHOGENIC_FOCI_resultSpecData === 'Punctate_echogenic_foci') {
            const Punctate_echogenic_foci = document.getElementById("item5-2");
            Punctate_echogenic_foci.checked = true;
            ECHOGENIC_FOCI_Text.textContent = `Punctate_echogenic_foci`;
        }
        else {
            const Macrocalcifications = document.getElementById("item5-3");
            Macrocalcifications.checked = true;
            ECHOGENIC_FOCI_Text.textContent = `Macrocalcifications`;
        }

        //-------------------------------------------------------------ORIENTATION

        const ORIENTATION_elements = document.querySelectorAll('.ORIENTATION-result');
        const ORIENTATION_Text = document.getElementById('item6-text');
     
        let ORIENTATION_1_Value = null;
        let ORIENTATION_2_Value = null;

        ORIENTATION_elements.forEach(element => {
            const ORIENTATION_specData = element.getAttribute('ORIENTATION-spec');
            const ORIENTATION_valueData = parseFloat(element.getAttribute('ORIENTATION-value'));

            if (ORIENTATION_1_Value === null) {
                ORIENTATION_1_Value = ORIENTATION_valueData;
            } else if (ORIENTATION_2_Value === null) {
                ORIENTATION_2_Value = ORIENTATION_valueData;
            }
        
            console.log(`${ORIENTATION_specData}${ORIENTATION_valueData}`);
        });

        let ORIENTATION_resultSpecData = null;
        if (ORIENTATION_1_Value !== null && ORIENTATION_2_Value !== null) {
            if (ORIENTATION_1_Value > ORIENTATION_2_Value) {
                ORIENTATION_resultSpecData = ORIENTATION_elements[0].getAttribute('ORIENTATION-spec');
            } else {
                ORIENTATION_resultSpecData = ORIENTATION_elements[1].getAttribute('ORIENTATION-spec');
            }
        }

        if (ORIENTATION_resultSpecData === 'Parallel') {
            const Parallel = document.getElementById("item6-1");
            Parallel.checked = true; 
            ORIENTATION_Text.textContent = `Parallel`;
        }
        else {
            const Nonparallel = document.getElementById("item6-2");
            Nonparallel.checked = true;
            ORIENTATION_Text.textContent = `Nonparallel`;
        }
        
        //-------------------------------------------------------------SHAPE

        const SHAPE_elements = document.querySelectorAll('.SHAPE-result');
        const SHAPE_Text = document.getElementById('item7-text');
     
        let SHAPE_1_Value = null;
        let SHAPE_2_Value = null;

        SHAPE_elements.forEach(element => {
            const SHAPE_specData = element.getAttribute('SHAPE-spec');
            const SHAPE_valueData = parseFloat(element.getAttribute('SHAPE-value'));

            if (SHAPE_1_Value === null) {
                SHAPE_1_Value = SHAPE_valueData;
            } else if (SHAPE_2_Value === null) {
                SHAPE_2_Value = SHAPE_valueData;
            }
        
            console.log(`${SHAPE_specData}${SHAPE_valueData}`);
        });

        let SHAPE_resultSpecData = null;
        if (SHAPE_1_Value !== null && SHAPE_2_Value !== null) {
            if (SHAPE_1_Value > SHAPE_2_Value) {
                SHAPE_resultSpecData = SHAPE_elements[0].getAttribute('SHAPE-spec');
            } else {
                SHAPE_resultSpecData = SHAPE_elements[1].getAttribute('SHAPE-spec');
            }
        }

        if (SHAPE_resultSpecData === 'Round_to_oval') {
            const Round_to_oval = document.getElementById("item7-1");
            Round_to_oval.checked = true; 
            SHAPE_Text.textContent = `Round_to_oval`;
        }
        else {
            const Irregular = document.getElementById("item7-2");
            Irregular.checked = true;
            SHAPE_Text.textContent = `Irregular`;
        }

        //-------------------------------------------------------------COMPOSITION

        const COMPOSITION_elements = document.querySelectorAll('.COMPOSITION-result');
        const COMPOSITION_Text = document.getElementById('item8-text');
     
        let COMPOSITION_1_Value = null;
        let COMPOSITION_2_Value = null;
        let COMPOSITION_3_Value = null;
        let COMPOSITION_4_Value = null;
        let COMPOSITION_5_Value = null;

        COMPOSITION_elements.forEach(element => {
            const COMPOSITION_specData = element.getAttribute('COMPOSITION-spec');
            const COMPOSITION_valueData = parseFloat(element.getAttribute('COMPOSITION-value'));

            if (COMPOSITION_1_Value === null) {
                COMPOSITION_1_Value = COMPOSITION_valueData;
            } else if (COMPOSITION_2_Value === null) {
                COMPOSITION_2_Value = COMPOSITION_valueData;
            } else if (COMPOSITION_3_Value === null) {
                COMPOSITION_3_Value = COMPOSITION_valueData;
            } else if (COMPOSITION_4_Value === null) {
                COMPOSITION_4_Value = COMPOSITION_valueData;
            } else if (COMPOSITION_5_Value === null) {
                COMPOSITION_5_Value = COMPOSITION_valueData;
            } 
        
            console.log(`${COMPOSITION_specData}${COMPOSITION_valueData}`);
        });

        let COMPOSITION_resultSpecData = null;
        if (COMPOSITION_1_Value !== null && COMPOSITION_2_Value !== null && COMPOSITION_3_Value !== null && COMPOSITION_4_Value !== null && COMPOSITION_5_Value !== null) {
            
            var maxCOMPOSITIONValue = Math.max(COMPOSITION_1_Value, COMPOSITION_2_Value, COMPOSITION_3_Value, COMPOSITION_4_Value, COMPOSITION_5_Value);

            if (maxCOMPOSITIONValue === COMPOSITION_1_Value) {
                COMPOSITION_resultSpecData = COMPOSITION_elements[0].getAttribute('COMPOSITION-spec');
            } else if (maxCOMPOSITIONValue === COMPOSITION_2_Value) {
                COMPOSITION_resultSpecData = COMPOSITION_elements[1].getAttribute('COMPOSITION-spec');
            } else if (maxCOMPOSITIONValue === COMPOSITION_3_Value) {
                COMPOSITION_resultSpecData = COMPOSITION_elements[2].getAttribute('COMPOSITION-spec');
            } else if (maxCOMPOSITIONValue === COMPOSITION_4_Value) {
                COMPOSITION_resultSpecData = COMPOSITION_elements[3].getAttribute('COMPOSITION-spec');
            } else {
                COMPOSITION_resultSpecData = COMPOSITION_elements[4].getAttribute('COMPOSITION-spec');
            }
        }

        if (COMPOSITION_resultSpecData === 'Solid') {
            const Solid = document.getElementById("item8-1");
            Solid.checked = true; 
            COMPOSITION_Text.textContent = `Solid`;
        }
        else if (COMPOSITION_resultSpecData === 'Predominantly_Solid') {
            const Predominantly_Solid = document.getElementById("item8-2");
            Predominantly_Solid.checked = true;
            COMPOSITION_Text.textContent = `Predominantly_Solid`;
        }
        else if (COMPOSITION_resultSpecData === 'Benign_Cystic') {
            const Benign_Cystic = document.getElementById("item8-3");
            Benign_Cystic.checked = true;
            COMPOSITION_Text.textContent = `Benign_Cystic`;
        }
        else if (COMPOSITION_resultSpecData === 'Colloid') {
            const Colloid = document.getElementById("item8-4");
            Colloid.checked = true;
            COMPOSITION_Text.textContent = `Colloid`;
        }
        else {
            const Spongiform = document.getElementById("item8-5");
            Spongiform.checked = true;
            COMPOSITION_Text.textContent = `Spongiform`;
        }

        //-------------------------------------------------------------GRADE

        const GRADE_elements = document.querySelectorAll('.GRADE-result');
        const GRADE_Text = document.getElementById('item9-text');
     
        let GRADE_2_Value = null;
        let GRADE_3_Value = null;
        let GRADE_4_Value = null;
        let GRADE_5_Value = null;

        GRADE_elements.forEach(element => {
            const GRADE_specData = element.getAttribute('GRADE-spec');
            const GRADE_valueData = parseFloat(element.getAttribute('GRADE-value'));

           if (GRADE_2_Value === null) {
                GRADE_2_Value = GRADE_valueData;
            } else if (GRADE_3_Value === null) {
                GRADE_3_Value = GRADE_valueData;
            } else if (GRADE_4_Value === null) {
                GRADE_4_Value = GRADE_valueData;
            } else if (GRADE_5_Value === null) {
                GRADE_5_Value = GRADE_valueData;
            } 
        
            console.log(`${GRADE_specData}${GRADE_valueData}`);
        });

        let GRADE_resultSpecData = null;
        if (GRADE_2_Value !== null && GRADE_3_Value !== null && GRADE_4_Value !== null && GRADE_5_Value !== null) {
            
            var maxGRADEValue = Math.max(GRADE_2_Value, GRADE_3_Value, GRADE_4_Value, GRADE_5_Value);

            if (maxGRADEValue === GRADE_2_Value) {
                GRADE_resultSpecData = GRADE_elements[0].getAttribute('GRADE-spec');
            } else if (maxGRADEValue === GRADE_3_Value) {
                GRADE_resultSpecData = GRADE_elements[1].getAttribute('GRADE-spec');
            } else if (maxGRADEValue === GRADE_4_Value) {
                GRADE_resultSpecData = GRADE_elements[2].getAttribute('GRADE-spec');
            } else if (maxGRADEValue === GRADE_5_Value) {
                GRADE_resultSpecData = GRADE_elements[3].getAttribute('GRADE-spec');
            }
        }

        if (GRADE_resultSpecData === 'C2') {
            const C2 = document.getElementById("item9-2");
            C2.checked = true; 
            GRADE_Text.textContent = `K-TIRADS 2`;
        }
        else if (GRADE_resultSpecData === 'C3') {
            const C3 = document.getElementById("item9-3");
            C3.checked = true; 
            GRADE_Text.textContent = `K-TIRADS 3`;
        }
        else if (GRADE_resultSpecData === 'C4') {
            const C4 = document.getElementById("item9-4");
            C4.checked = true;
            GRADE_Text.textContent = `K-TIRADS 4`;
        }
        else if (GRADE_resultSpecData === 'C5') {
            const C5 = document.getElementById("item9-5");
            C5.checked = true;
            GRADE_Text.textContent = `K-TIRADS 5`;
        }
        else {
            const C1 = document.getElementById("item9-1");
            C1.checked = true;
            GRADE_Text.textContent = `K-TIRADS 1`;
        }
 
    </script>
    






    <script>
        // 체크박스 변경 시 이벤트 처리
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');

        const item0Text = document.getElementById('item0-text');
        const item00Text = document.getElementById('item00-text');
        const item1Text = document.getElementById('item1-text');
        const item2Text = document.getElementById('item2-text');
        const item3Text = document.getElementById('item3-text');
        const item4Text = document.getElementById('item4-text');
        const item5Text = document.getElementById('item5-text');
        const item6Text = document.getElementById('item6-text');
        const item7Text = document.getElementById('item7-text');
        const item8Text = document.getElementById('item8-text');
        const item9Text = document.getElementById('item9-text');

        const textarea = document.getElementById('selected_items'); // textarea 엘리먼트 선택
        const resetButton = document.querySelector('.interpretation_reset'); // 초기화 버튼 선택

        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const labelText = document.querySelector(`label[for="${this.id}"]`).textContent;

                // 체크된 항목의 값을 가져옴
                const checkedItemValue = this.checked ? labelText : "";

                // 항목1~9 위치에 텍스트 추가
                if (this.id === "item0-1" || this.id === "item0-2") {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox.id !== this.id && otherCheckbox.name === this.name) {
                            otherCheckbox.checked = false; // 다른 항목들 해제
                        }
                    });
                    item0Text.textContent = ` ${checkedItemValue}`;
                }
                else if (this.id === "item00-1" || this.id === "item00-2") {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox.id !== this.id && otherCheckbox.name === this.name) {
                            otherCheckbox.checked = false;
                        }
                    });
                    item00Text.textContent = ` ${checkedItemValue}`;
                }
                else if (this.id === "item1-1" || this.id === "item1-2" || this.id === "item1-3") {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox.id !== this.id && otherCheckbox.name === this.name) {
                            otherCheckbox.checked = false; // 다른 항목들 해제
                        }
                    });
                    if (this.id === "item1-1") {
                        item1Text.textContent = `right`;
                    } else if (this.id === "item1-2") {
                        item1Text.textContent = `left`;
                    } else if (this.id === "item1-3") {
                        item1Text.textContent = `lsthmus`;
                    }
                    
                }
                else if (this.id === "item2-1" || this.id === "item2-2" || this.id === "item2-3") {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox.id !== this.id && otherCheckbox.name === this.name) {
                            otherCheckbox.checked = false;
                        }
                    });
                    item2Text.textContent = ` ${checkedItemValue}`;
                }
                else if (this.id === "item3-1" || this.id === "item3-2") {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox.id !== this.id && otherCheckbox.name === this.name) {
                            otherCheckbox.checked = false;
                        }
                    });
                    item3Text.textContent = ` ${checkedItemValue}`;
                }
                else if (this.id === "item4-1" || this.id === "item4-2" || this.id === "item4-3") {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox.id !== this.id && otherCheckbox.name === this.name) {
                            otherCheckbox.checked = false;
                        }
                    });
                    item4Text.textContent = ` ${checkedItemValue}`;
                }
                else if (this.id === "item5-1" || this.id === "item5-2" || this.id === "item5-3") {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox.id !== this.id && otherCheckbox.name === this.name) {
                            otherCheckbox.checked = false;
                        }
                    });
                    item5Text.textContent = ` ${checkedItemValue}`;
                }
                else if (this.id === "item6-1" || this.id === "item6-2") {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox.id !== this.id && otherCheckbox.name === this.name) {
                            otherCheckbox.checked = false;
                        }
                    });
                    item6Text.textContent = ` ${checkedItemValue}`;
                }
                else if (this.id === "item7-1" || this.id === "item7-2") {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox.id !== this.id && otherCheckbox.name === this.name) {
                            otherCheckbox.checked = false;
                        }
                    });
                    item7Text.textContent = ` ${checkedItemValue}`;
                }
                else if (this.id === "item8-1" || this.id === "item8-2" || this.id === "item8-3" || this.id === "item8-4" || this.id === "item8-5") {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox.id !== this.id && otherCheckbox.name === this.name) {
                            otherCheckbox.checked = false;
                        }
                    });
                    item8Text.textContent = ` ${checkedItemValue}`;
                }
                else if (this.id === "item9-1" || this.id === "item9-2" || this.id === "item9-3" || this.id === "item9-4" || this.id === "item9-5") {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox.id !== this.id && otherCheckbox.name === this.name) {
                            otherCheckbox.checked = false;
                        }
                    });
                    item9Text.textContent = ` ${checkedItemValue}`;
                }

                // textarea에 original_interpretation 내용 복사
                const containerAText = document.querySelector('.original_interpretation').innerText;
                textarea.value = containerAText; 
            });
        });

        // 초기화 버튼 클릭 시
        resetButton.addEventListener('click', function() {
            // 모든 체크박스 해제
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });

            // 텍스트 초기화
            // 초기화 시 ltlux 결과 불러오는 함수 작동

            document.getElementById("volume-result2").textContent = '(    )';

            // 부피 계산 입력값 초기화
            document.getElementById("width").value = '';
            document.getElementById("height").value = '';
            document.getElementById("depth").value = '';
            
            // 부피 결과 및 최대 크기 초기화
            document.getElementById("volume-result").textContent = '';
            document.getElementById("largestNumber").textContent = '';

            // 단위 선택 옵션 초기화
            unitSelector.value = 'mm';

            // 단위 표시 초기화
            document.getElementById("currentUnit").textContent = 'mm'; // 단위 'mm'로 초기화
            
            // textarea에 빈 문자열 설정
            // textarea.value = '';
        });

    </script>



    <script>
        
        function confirm_delete_interpretation(button) {
            if (confirm("정말 삭제하시겠습니까?")) {
                button.closest("form").submit();
            }
        }

        function confirm_delete_comment(button) {
            if (confirm("정말 삭제하시겠습니까?")) {
                button.closest("form").submit();
            }
        }


        function dontDelete() {
            alert("삭제는 본인만 가능합니다.");
        }

        $("#agree_btn").click(function(){
            $("form#agree_form").css("display","block");
        })

        $("#disagree_btn").click(function(){
            $("form#disagree_form").css("display","block");
        })

        $(":reset").click(function(){
            $("form").css("display","none");
        })

        
        {% if crop_img.is_nodule %}
            $("p.{{crop_img.classifi_result|get_max_spec:'BM'}}").css({"color":"blue", "font-weight":"bold"});
            $("p.{{crop_img.classifi_result|get_max_spec:'PN'}}").css({"color":"blue", "font-weight":"bold"});
            $("p.{{crop_img.classifi_result|get_max_spec:'ECHO'}}").css({"color":"blue", "font-weight":"bold"});
            $("p.{{crop_img.classifi_result|get_max_spec:'MARGIN'}}").css({"color":"blue", "font-weight":"bold"});
            $("p.{{crop_img.classifi_result|get_max_spec:'ECHOGENIC_FOCI'}}").css({"color":"blue", "font-weight":"bold"});
            $("p.{{crop_img.classifi_result|get_max_spec:'ORIENTATION'}}").css({"color":"blue", "font-weight":"bold"});
            $("p.{{crop_img.classifi_result|get_max_spec:'SHAPE'}}").css({"color":"blue", "font-weight":"bold"});
            $("p.{{crop_img.classifi_result|get_max_spec:'COMPOSITION'}}").css({"color":"blue", "font-weight":"bold"});
            $("p.{{crop_img.classifi_result|get_max_spec:'GRADE'}}").css({"color":"blue", "font-weight":"bold"});
        {% endif %}
        
        const text_interpretation = document.querySelector('.id_interpretation');
        const btn_interpretation = document.querySelector('.interpretation_write_button');
        var interpretation_modal_close = document.getElementsByClassName("interpretation_close_button")[0];    

        btn_interpretation.addEventListener('click', () => {
            text_interpretation.style.display = 'block';

                // textarea에 original_interpretation 내용 복사
                const containerAText = document.querySelector('.original_interpretation').innerText;

                textarea.value = containerAText; 
        interpretation_modal_close.onclick = function() {
            text_interpretation.style.display = "none";
            }
        }); 

    </script>
{% endblock %}